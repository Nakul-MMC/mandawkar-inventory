{% extends "base.html" %}

{% block content %}

<h3 class="mb-4">Inventory</h3>

<!-- ACTION BAR -->
<div class="d-flex justify-content-between align-items-center mb-3">

    <!-- Category Filter -->
    <form method="GET" class="d-flex gap-2">
        <select name="category" class="form-select"
                onchange="this.form.submit()">
            <option value="">All Categories</option>
            <option value="Tiles" {% if selected_category == "Tiles" %}selected{% endif %}>Tiles</option>
            <option value="Granite" {% if selected_category == "Granite" %}selected{% endif %}>Granite</option>
            <option value="Kadappa" {% if selected_category == "Kadappa" %}selected{% endif %}>Kadappa</option>
            <option value="Chemicals" {% if selected_category == "Chemicals" %}selected{% endif %}>Chemicals</option>
        </select>
    </form>

    <!-- Export Buttons -->
    <div>
        <a href="/export" class="btn btn-success">
            <i class="bi bi-file-earmark-excel"></i> Export
        </a>

        <a href="mailto:?subject=Mandawkar Inventory Report&body=Please find the attached inventory Excel report."
           class="btn btn-secondary ms-2">
            <i class="bi bi-envelope"></i> Send Email
        </a>
    </div>
</div>

<!-- INVENTORY TABLE -->
<div class="card p-3">

<table class="table table-hover align-middle mb-0">
    <thead>
        <tr>
            <th>Category</th>
            <th>Size</th>
            <th>Type</th>
            <th>Variant</th>
            <th>Pattern</th>
            <th>Quantity</th>
            <th>Price (â‚¹)</th>
            <th>Last Updated</th>
            <th style="width: 160px;">Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for p in products %}
        <tr>
            <td>{{ p[1] }}</td>
            <td>{{ p[2] or "-" }}</td>
            <td>{{ p[3] or "-" }}</td>
            <td>{{ p[4] or "-" }}</td>
            <td>{{ p[5] or "-" }}</td>
            <td>{{ p[6] }}</td>
            <td>{{ p[7] }}</td>
            <td>{{ p[8] }}</td>
            <td>

                <!-- EDIT -->
                <a href="/edit/{{ p[0] }}"
                   class="btn btn-sm btn-primary">
                    Edit
                </a>

                <!-- DELETE -->
                <form method="POST"
                      action="/delete-product/{{ p[0] }}"
                      style="display:inline;"
                      onsubmit="return confirm('Are you sure you want to delete this product? This action cannot be undone.');">

                    <button class="btn btn-sm btn-danger">
                        Delete
                    </button>
                </form>

            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

</div>

{% endblock %}
